<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapperInterface.MemberMapper">

	<sql id="search">
	<!-- 1) 조건값 CONCAT('%',#{keyword},'%') 처리 -->
		<if test="keyword != null">
			<bind name="keyval" value="'%'+keyword+'%'"/>
		</if>
	<!-- 2) Like 조건문 처리 -->
		<choose>
			<when test="searchType == 'all' and keyword != null">
			<!-- id, title, content 에서 keyword 가 포함된 글목록-->
				WHERE
				id LIKE #{keyval}
				OR name LIKE #{keyval}
				OR age LIKE #{keyval}
				OR jno LIKE #{keyval}
				OR info LIKE #{keyval}
				OR point LIKE #{keyval}
				OR birthday LIKE #{keyval}
				OR rid LIKE #{keyval}
			</when>		
			<when test="searchType!= null and keyword !=null">
			<!-- searchType 컬럼명 에서 keyword 가 포함된 글목록 -->
				WHERE ${searchType} LIKE #{keyval}
			</when>		
			<otherwise></otherwise>
		</choose>
	</sql> 

	<!-- ** selectList  -->
	<select id="selectList" resultType="com.ncs.spring02.domain.MemberDTO">
		SELECT * FROM member
	</select>
	
	<!-- ** selectOne  -->
	<select id="selectOne" resultType="com.ncs.spring02.domain.MemberDTO">
		SELECT * FROM member WHERE id = #{id}
	</select>
	
	<!-- ** insert  -->
	<insert id="insert" >
		INSERT INTO  member VALUES (#{id},#{password},#{name}
		,#{age},#{jno},#{info},#{point},#{birthday},#{rid},#{uploadfile})
	</insert>
	
	<!-- ** update  -->
	<update id="update" >
		UPDATE member SET name=#{name}, age=#{age}, jno=#{jno}, info=#{info}
		, point=#{point}, birthday=#{birthday}, rid=#{rid}, uploadfile=#{uploadfile} WHERE id= #{id}
	</update>
	
	<!-- ** pwUpdate  -->
	<update id="pwUpdate">
		UPDATE member SET password = #{password} WHERE id = #{id}
	</update>
		
	<!-- ** delete  -->
	<delete id="delete">
		DELETE FROM member WHERE id = #{id}
	</delete>
	
	<!-- ** selectJoList -->
	<select id="selectJoList" resultType="com.ncs.spring02.domain.MemberDTO">
		SELECT * FROM member WHERE jno = #{jno}
	</select>
	
	<!-- ** mPageList -->
	<select id="mPageList" resultType="com.ncs.spring02.domain.MemberDTO">
		SELECT * FROM member
	</select>
	
	<select id="totalRowsCount" resultType="int">
		SELECT COUNT(*) FROM member
	</select>
	
	<select id="mSearchList" resultType="com.ncs.spring02.domain.MemberDTO">
		SELECT * FROM member 
		<include refid="search"></include> 
		LIMIT #{sno}, #{rowsPerPage}
	</select>
	
	<select id="mSearchRowsCount" resultType="int">
		SELECT COUNT(*) FROM member
		<include refid="search"></include>
	</select>
	
	<select id="mCheckList" resultType="com.ncs.spring02.domain.MemberDTO">
      SELECT *
      FROM member
      <if test="check != null">
    	  WHERE jno IN 
    	  <foreach collection="check" item="it" open="(" close=")" separator=",">
	    	  #{it}
    	  </foreach>
      </if>
      LIMIT #{sno}, #{rowsPerPage}
   </select>
   
   <select id="checkRowsCount" resultType="int">
   	SELECT COUNT(*) FROM member
   	<if test="check != null">
    	WHERE jno IN 
    	<foreach collection="check" item="it" open="(" close=")" separator=",">
	    	#{it}
    	</foreach>
    </if>
   </select>
	
</mapper>